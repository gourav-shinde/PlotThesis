\section{Discussion}

In this section, we discuss the various aspects of our research on the WARPED simulation kernel, including model characteristics, configuration considerations, and the performance implications of different branch implementations.

\subsection{Model Characteristics and Performance}

The choice of simulation model significantly influences the performance of the WARPED kernel. We examined several models, including synthetic models like Traffic and PCS, as well as real-world models such as Epidemic-10k-ba and Epidemic-100k-ba \cite{perumalla2012discrete}. These models vary in their computational requirements and event distribution patterns, affecting the overall simulation performance.

The Epidemic model, for instance, simulates disease outbreak phenomena using a combination of reaction and diffusion processes \cite{barrett2008episimdemics}. It incorporates complex interactions between entities, network structures (e.g., Watts-Strogatz \cite{watts1998collective} and Barabasi-Albert \cite{barabasi1999emergence} graphs), and geographical diffusion, making it particularly challenging for parallel discrete event simulation (PDES) systems.

\subsection{Configuration and Platform Considerations}

While testing proposed changes to the WARPED kernel, it is crucial to determine the scenarios and platforms where they perform optimally. Factors such as instruction sets and specialized hardware can significantly impact performance. As noted earlier, the model itself plays a critical role in determining whether a particular configuration of WARPED works efficiently and quickly.

The debate between GPU and CPU computing for PDES algorithms is ongoing. While GPUs excel at performing simple tasks quickly, CPUs are better suited for handling complex, lengthy computations often required in sophisticated simulations at the Logical Process (LP) level. The choice between platforms depends on the specific requirements of the model and the nature of the computations involved.

\subsection{Performance Factors and Optimization}

Several factors influence the performance of WARPED simulations:

\subsubsection{Event Processing Time}

Models like PCS have longer processing times for events at each LP. The grid size, representing the number of LPs, determines the scope of the simulation. It's important to note that the maximum simulation time (max-sim-time) represents the timestamp of the last generated event, not the actual runtime of the simulation.

\subsubsection{State Saving and Rollbacks}

The relationship between state-saving period and average rollback length is crucial for optimization. We derived a mathematical model to analyze this relationship:

\begin{equation}
T = 10,000 \cdot t_{process} + \frac{10,000}{n} \cdot t_{save} + 10,000 \cdot p \cdot \frac{n}{2} \cdot t_{rollback}
\end{equation}

Where:
\begin{itemize}
    \item $T$ is the total time
    \item $t_{process}$ is the time to process one event
    \item $t_{save}$ is the time to save a state
    \item $t_{rollback}$ is the time to rollback and reprocess one event
    \item $p$ is the probability of a rollback occurring per event
    \item $n$ is the number of events between state saves
\end{itemize}

This model helps in determining the optimal state-saving interval that balances the overhead of state saving with the cost of rollbacks.

\subsection{Branch Implementations}

We explored several branch implementations for the WARPED kernel, each focusing on different optimization strategies:

\subsubsection{Master Branch}

The master branch represents the original implementation of the WARPED 2 kernel. It supports both asynchronous and synchronous Global Virtual Time (GVT) implementations, uses a multiset scheduled queue, and maintains separate processed and unprocessed input queues. This serves as our baseline for comparison with other optimizations.

\subsubsection{Fossil Branch}

The fossil branch introduces a separate fossil collection thread, eliminating the need for locks during fossil collection. Key features include:

\begin{itemize}
    \item Tweaks to algorithms to avoid locks during fossil collection
    \item Potential performance gains on systems without hyperthreading
    \item Similar runtime to master branch on systems with hyperthreading
\end{itemize}

Our experiments revealed that simulations with 3+1 threads (3 worker threads and 1 fossil collection thread) resulted in fewer rollbacks. Increasing to 6 threads provided some performance gain, but the improvement was limited due to the increased number of rollbacks. This behavior is likely related to cache swapping delays on our test system with 4 main cores.

\subsubsection{SIMD Branch}

The SIMD branch aimed to leverage SIMD instructions provided by the AVX platform. However, significant challenges were encountered:

\begin{itemize}
    \item Requires contiguous memory allocation for members of the Event class
    \item Necessitates overhauling MPI serialization for multi-node simulations
    \item Implementation incomplete due to extensive changes required in the WARPED 2 algorithm
\end{itemize}

While not fully implemented, this branch highlights the potential for SIMD optimizations in future work.

\subsubsection{Hashing Branch}

The hashing branch implements a technique to reduce the cost of event comparisons:

\begin{itemize}
    \item Uses hashing for LP names
    \item One-time hashing cost followed by quick comparisons
    \item Showed performance gains in experiments
    \item Potential for further improvement using advanced techniques like Google's MurmurHash
\end{itemize}

\subsubsection{Relaxed Compare Branch}

This branch explores a relaxed compare function based on the hypothesis that strict ordering in the scheduled queue is not always necessary:

\begin{itemize}
    \item Relies on strict ordering at the LP level instead of the global level
    \item Can fail in certain scenarios
    \item Showed significant performance gains for some models, particularly those with high LP event processing times
\end{itemize}

\subsubsection{Unified Queue Branch}

The unified queue branch implements a combined approach:

\begin{itemize}
    \item Joins processed and unprocessed events into a single ordered circular queue
    \item Uses synchronous GVT
    \item Implements a multiset schedule queue with relaxed ordering
    \item Utilizes a circular random access iterator for efficient sorting
    \item Eliminates unnecessary barriers in the simulation
\end{itemize}

This branch showed promising results by streamlining queue management and reducing synchronization overhead.

\subsection{GVT Implementation Comparison}

Across our branch implementations, we observed that:

\begin{itemize}
    \item Synchronous GVT implementation showed better performance on single-node simulations
    \item Asynchronous GVT performed better on multi-node systems
\end{itemize}

These findings align with the general industry understanding of GVT types and their optimal use cases.

\subsection{Future Work}

Future research could explore several promising directions:

\begin{itemize}
    \item Leveraging new hardware features, such as eco-cores in modern CPUs, for tasks like fossil collection
    \item Further optimization of the SIMD implementation to overcome current challenges
    \item Exploration of advanced hashing techniques to improve event comparison efficiency
    \item Investigating hybrid approaches that combine the strengths of different branch implementations
\end{itemize}

In conclusion, our research has highlighted the complex interplay between model characteristics, configuration choices, and branch implementations in optimizing the performance of the WARPED simulation kernel. Each branch implementation offers unique advantages and trade-offs, demonstrating the potential for significant improvements in simulation efficiency through targeted optimizations. By carefully considering these factors and applying the most suitable optimizations for specific simulation scenarios, we can continue to enhance the capabilities and performance of the WARPED simulation kernel.